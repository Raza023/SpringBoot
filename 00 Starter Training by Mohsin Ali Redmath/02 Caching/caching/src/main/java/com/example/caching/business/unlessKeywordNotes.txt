Here are **clean, correct, ready-to-use examples** showing how to use **`unless`** in your existing caching methods.
I‚Äôll show **where and how to apply it**, and what each condition means.

---

# ‚úÖ **What is `unless`?**

`unless` **prevents caching** when the condition is `true`.
It is **checked AFTER method execution** (because it can inspect `#result`).

Example:

```java
@Cacheable(value = "userIdCache", key = "#id", unless = "#result == null")
```

‚Üí Cache only if method returned a non-null result.

---

# ‚úÖ Add `unless` to your methods

Below are improved versions of your methods **with `unless` added safely and correctly**.

---

## ‚úÖ 1. Cache Get User By ID

Cache **ONLY when user exists** (skip caching null).

```java
@Cacheable(
    value = "userIdCache",
    key = "#id",
    unless = "#result == null"
)
@Transactional
public UserDto getUserById(Long id) {
    return userDataService.findById(id)
            .map(UserDto::getUserDto)
            .orElse(null);
}
```

---

## ‚úÖ 2. Cache Get User By Email

Same logic‚Äîno cache if user not found.

```java
@Cacheable(
    value = "userEmailCache",
    key = "#email",
    unless = "#result == null"
)
@Transactional
public UserDto getUserByEmail(String email) {
    return userDataService.findByEmail(email)
            .map(UserDto::getUserDto)
            .orElse(null);
}
```

---

## ‚úÖ 3. Save User ‚Äî Avoid caching invalid users

Cache only if the user has both ID & email (never cache corrupted results).

```java
@Caching(put = {
        @CachePut(
            value = "userIdCache",
            key = "#result.id",
            unless = "#result == null or #result.id == null"
        ),
        @CachePut(
            value = "userEmailCache",
            key = "#result.email",
            unless = "#result == null or #result.email == null"
        )
})
@Transactional
public UserDto saveUser(User user) {
    return UserDto.getUserDto(userDataService.saveAndFlush(user));
}
```

---

## ‚úÖ 4. Update User ‚Äî Only cache when update was successful

If `id` doesn‚Äôt exist, method returns `null` ‚Üí skip caching.

```java
@Caching(put = {
        @CachePut(
            value = "userIdCache",
            key = "#result.id",
            unless = "#result == null"
        ),
        @CachePut(
            value = "userEmailCache",
            key = "#result.email",
            unless = "#result == null"
        )
})
@Transactional
public UserDto updateUser(Long id, User updatedUser) {
    return userDataService.findById(id)
            .map(existingUser -> {
                existingUser.setName(updatedUser.getName());
                existingUser.setEmail(updatedUser.getEmail());
                return userDataService.saveAndFlush(existingUser);
            }).map(UserDto::getUserDto).orElse(null);
}
```

---

## ‚ùó 5. Delete User ‚Äî `unless` **cannot be used here**

Because:

* `@CacheEvict` executes **before** method
* There is **no #result object**
* And you already fetch local `user`

So **no unless needed**, your delete logic is already correct.

---

# üéâ Summary of Best Practices for `unless`

| Use Case           | Should Use `unless`? | Why                              |
| ------------------ | -------------------- | -------------------------------- |
| `getUserById()`    | ‚úî Yes                | Avoid caching null results       |
| `getUserByEmail()` | ‚úî Yes                | Avoid caching null results       |
| `saveUser()`       | ‚úî Yes                | Avoid caching invalid user       |
| `updateUser()`     | ‚úî Yes                | Avoid caching null update        |
| `deleteUser()`     | ‚ùå No                 | `unless` doesn‚Äôt work with evict |

---

If you want, I can also:
‚úÖ Add `condition = ""` examples
‚úÖ Add Redis TTL per cache
‚úÖ Show how to combine `condition` + `unless`
Just tell me!
